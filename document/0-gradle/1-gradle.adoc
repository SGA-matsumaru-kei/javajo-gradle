= Gradleについて

Gradleは各種作業を自動実行するための基盤ツールです。
プロジェクトの成果物を生成することをビルドとも呼ぶので、ビルドツールとも呼ばれています。

.ビルドとは？
* プロジェクトでの定義により異なるが、目的を達成すること
** jar/warファイルを作るだけにとどまらず、それらをDockerイメージとともにzipで固めてbeanstalkにデプロイするまでを含めてビルドと呼ぶこともできます。
** Rubyプロジェクトのようにコンパイルは必要ない言語においても、アプリケーションとして動作させるために必要な作業(テスト/DBマイグレーション/サーバーへのリリース)もビルドと呼ぶことができます。

一般的にビルドツールに求められる機能は次のようなものではないでしょうか

.ビルドツールに求められる機能
** コンパイルに必要な各種ライブラリーの収集・管理
** コンパイル(コンパイル系言語)
** プロダクションに対するテスト
** プロダクションを配布可能な形態へ変換する
** プロダクションを配布する

ビルドそのものは膨大な作業になるので、それらを構成する小さな単位の作業をタスクと呼びます。

.タスクにはどのようなものがあるか
* タスクには次のようなものがあげられます
** Javaファイルをコンパイルする作業
** リソースファイルから必要な物だけを選別して、一時的なディレクトリーにコピーする作業
** テストを走らせる作業
** テスト結果を集計してまとめる作業
** ...etc

これら膨大なタスクをまとめて実行することも、個々に(タスクを実行するために必要な別のタスクも含めて)実行することも可能にしているのがGradleです
(mavenでは途中のタスクだけ実行ということができない https://gradle.org/maven_vs_gradle/[Gradleの公式資料：Gradle vs Maven] より)。

== プラグインシステム

ここまではGradleは何でもできるということを言ってきましたが、実際のところを言うと、Gradleそのものでは何もすることはできません(ファイルのコピーすらできない)。

Gradleはプラグインシステムを採用しており、それらをプロジェクトに適用して初めてなんらかのビルドを実行できるようになります。

オフィシャルに提供されているプラグインには次のようなものがあります。

.オフィシャルプラグイン
* `Build init` プラグイン
** ビルド定義ファイル `build.gradle` およびプロジェクトの雛形を提供するプラグイン
* `base` プラグイン
** Gradleに必要最低限の機能(依存性管理・各種タスクの雛形)を持たせるプラグイン
* `java` プラグイン
** Javaプロジェクトの依存性管理・ビルド・テストを行い、jarを生成するビルドを提供する
* `war` プラグイン
** JavaのWebアプリケーションプロジェクトの依存性管理・ビルド・テストを行い、warを生成するビルドを提供する
* `maven-publish` プラグイン
** Javaプラグインで作成したjarファイルをmavenレポジトリーにアップロードするビルドを提供する

またサードパーティ製のプラグインには次のようなものがあります。

.サードパーティ製のプラグインの例
* `com.android.application` プラグイン
** Androidアプリケーションプロジェクトの依存性管理・ビルド・テスト・サインを行い、リリース可能なapkファイルを生成するビルドを提供する
* `Gretty` プラグイン
** warアプリケーションを各種(tomcat/jettyの各種バージョン)サーブレットコンテナで走らせるビルドを提供する

= ビルドツール

参考ドキュメントは http://amazon.co.jp/o/ASIN/B00PC1JPJE/kkkjkrt-22[Gradle徹底入門]

== Make

ビルドツールの元祖。実行するコマンド、対象ファイル、出力ディレクトリーを定義(configure)して実行するツール。

ビルドの定義は `Makefile` に記述します。

== Ant

Javaのポイントであるwrite once, run anywhereを実現したプラットフォーム非依存のツール。

* XMLで対象ファイル、出力ディレクトリーなどを定義(configure)して実行するツール。
* シンプルで使いやすく、登場から15年ほど経ても未だに現役で活躍するツール。
* ビルドが大きくなると、XMLファイル自体も大きくなり、XMLファイルの人間との相性の悪さからメンテナンス性が悪く、ビルド職人という職業を作った。
* 依存性の管理機能がなく(後年Ivyによりカバーする)、ライブラリー管理に関してビルド職人を悩ませた。

ビルドの定義は `build.xml` に定義します。

== Maven

Antの自由度(configurationゆえの記述量の多さ、標準性のなさ)を規約(convention)により制限し、かつ依存性管理という仕組みを導入してAntの諸々の問題を解決したビルドツール。

* 規約(convention)により、定義(configuration)の記述を排除してビルド定義そのものを読みやすくして、メンテナンス性を向上させた。
* 規約(convention)を覚えなければならず、入門の敷居が高い
* 規約(convention)から外れたことを望んだ途端に、難易度があがってしまう
* XMLで記述するため、人間が読むには辛いところがある(反面、マシンにとっては読み取りやすいため、IDEのサポートが強力(IntelliJ IDEAを見ている限り…))。
* 最近では枯れた技術となり、Spring Boot用のプラグインはGradleのプラグインよりも高機能である。

ビルドの定義は `pom.xml` に記述します。

== その他

Scala用のsbtとかClojure用のLeiningenなどがありますが、それらの言語をやらないので詳しく知りません。

== Gradle

Mavenでプロジェクトの依存性の問題に取り組んでいたAdam Murdochが、Mavenでどうしても解決できない問題があることを発見し、2007年頃に開発を始めたツール

* 基本的な思想はMavenの規約(convention)によるビルドを継承して、必要最低限の記述でビルドできる
* ただし、規約に縛られるのではなく、Antの自由なところも取り入れている
* スクリプトの記述はGroovyで行われており、Ant/Mavenではできなかったデバッグ(プリントデバッグ)も可能にしている
** ビルドの主たる対象がJavaのプロジェクトであることから、Javaプログラマーでも読めるGroovyをスクリプティングのベース言語として採用した
** GroovyはJavaに足りない諸機能を拡張して、冗長なところを排除して、Javaのよいところ(型安全性)を継承した言語

ビルドの定義は `build.gradle` に記述します。

= Convention over Configuration build

.Configuration型のビルドツール(Ant/Make)
* 「何から」、「何を」ビルドするかを記述する

.Convention型のビルドツール(Gradle/Maven)
* 「何を」ビルドするかを記述する
* 「何から」というのはルール(convention)で決めてしまう

= Gradleの魅力

私見ですが、Gradleの魅力は次の点にあると考えています。

* Mavenの仕組みを活用した楽なビルド
* Antのように自由度が高い
* マルチプロジェクトにも柔軟に対応
* XMLではないので読みやすい
* プリントデバッグできる
** エラーがあっても何が問題なのか指摘してくれる
* Gradle wrapperによってチームで同じビルド環境を共有できる
* 他のJavaアプリケーションの中に組み込むこと(embedded)も可能
